---
title: "Cleaning Data"
author: "Olivia Liang"
date: "October 8, 2019"
output: html_document
---

# 1. Introduction and exploring raw data

## View information of a dataset
```{r}
weather <- readRDS("weather.rds.txt")

# View a condensed summary of the data
str(weather)

# View the class of the file (data.frame? or ?)
class(weather)

# View its dimension (return the number of rows and columns)
dim(weather)

# Look at the column names
names(weather)

# Easy way to reorder the column names of the dataset
df <- df[c(5, 1:4)]

# Use the dplyr package
library(dplyr)
# View the structure of the dataset in dplyr way(better version of str())
glimpse(weather)

# View the summary stats for each column
summmary(weather)

# View entire dataset(only for small dataset)
print(weather)

# View the first 6 rows of data
head(weather)

# View the first 10 rows of data
head(weather,10)

# View the last 6 rows of data
tail(weather)

```


## Rearrange columns 

select(): reorder columns
mutate_at(): convert characters to numerics
```{r}
# reorder columns
weather5 <- select(weather4, date, Events, CloudCover:WindDirDegrees)

# Convert characters to numerics
weather6 <- mutate_at(weather5, vars(CloudCover:WindDirDegrees), funs(as.numeric))

### visualize your data
# View histogram
hist(data$a_column)
# View plot of two variables
plot(data$year, data$spent)

```


# 2. Using 'tidyr' to tidy data

## gather and spread

**gather(): ** stack
e.g., gather(df, my_key, my_val, -col1)

'-col1' means we want to gather all columns except for the first column
df: a data frame
my_key, my_val: bare name of new key column and new value column


**spread():**
e.g., spread(df, my_key, my_val)
```{r}
library(tidyr)
### When column headers are values, not vairable names
# gather the columns into key-value pairs(similar to 'stack')
gather(df, my_key, my_val, -col1)

# another example: gather columns X1-X31. 
# The two columns created as a result should be called day and value
weather2 <- gather(weather, day, value, X1:X31, na.rm = TRUE)


### when variables are stored in both rows and columns
# spread key-value pairs into columns (similar to 'unstack')
spread(df, my_key, my_val)
```


## Separate and unite

**separate**
When multiple variables are stored in one column
e.g.,separate year_month into two columns

separate(df, year_month, c('year', 'month'), sep = '-')

**unite**
unite year and month to form year_month colulmn
e.g.,unite(df, year_month, year, month, sep = '-')

### a single observational unit is stored in multiple tables
### multiple types of observational units are stored in the same table
# => should be divided to be several tables based on the observational units

```{r}

unite(weather2, year_month, year,month, sep='-')
separate(weather2, year_month, c('year', 'month'), sep = '-')

```


# 3. Preparing data for analysis

## Convert variable types
```{r}
# type conversions
as.character(2016)
as.numeric(TRUE)
as.integer(99)
as.factor('something')
as.logical(0)
```

## lubridate package - coerce strings to dates
```{R}
library(lubridate)
# Experiment with basic lubridate functions
ymd('2015-08-25')
ymd('2015 August 25')
mdy('August 25, 2015')
hms('13:33:09')
ymd_hms('2015/08/25 13.33.09')

# Example: Coerce nurse_visit to a date and time
students2$nurse_visit <- ymd_hms(students2$nurse_visit)

# Example2: Separate or mutate the Date/Time columns
data14$Date.Time <- mdy_hms(data14$Date.Time)

data14$Year <- factor(year(data14$Date.Time))
data14$Month <- factor(month(data14$Date.Time))
data14$Day <- factor(day(data14$Date.Time))
data14$Weekday <- factor(wday(data14$Date.Time))
data14$Hour <- factor(hour(data14$Date.Time))
data14$Minute <- factor(minute(data14$Date.Time))
data14$Second <- factor(second(data14$Date.Time))
```

## String manipulaiton

```{r}
library(stringr)
# Trim leading and trailing white space
str_trim('  this is a test   ')
# return: 'this is a test'

# Pad string with zeros
str_pad('24492', width = 7, side = 'left', pad = '0')
# return: '0024492' 

# search for string in a vector
friends <- c('Sarah', 'Tom', 'Alice')
str_detect(friends, 'Alice')

# replace string in a vector
str_replace(friends, 'Alice','David')

# Make all lowercase
tolower('I AM TALKING LOUDLY')
# Make all uppercase
toupper('I am whispering....')

```


## Finding missing values


indice of the rows that have NA: *which(is.na())*
returns the rows that have no NA: *df[complete.cases(),]*
remove rows that have NA:*na.omit(df)*
```{r}
#check for NAs  (true anywhere is NA, False anywhere is not NA)
# only recommend for small dataframe
is.na(df)

# are there any NAs?
any(is.na(df))

# Find indices of missing values in column b
which(is.na(x$b))

# count number of NAs
sum(is.na(df))

# use summary() to find NAs
summary(df)

## Dealing with missing values
#find rows with no missing values => return True and False of rows
complete.cases(df)

# subset data, keeping only complete cases
df[complete.cases(df), ]

# Find indices of NAs in Max.Gust.SpeedMPH
ind <- which(is.na(weather6$Max.Gust.SpeedMPH))

# Look at the full rows for records missing Max.Gust.SpeedMPH
weather6[ind, ]

# Another way to remove rows with NAs
na.omit(df)

# the table() function shows you how often each string appears
# eg: call table() on the status column
table(df$status)

```


## Dealing with outliers
```{r}
# Simulate some data
set.seed(10)
x<- c(rnorm(30, mean = 15, sd = 5), -5, 28, 35)
# View a boxplot (a vector)
boxplot(x, horizontal = TRUE)

# View boxplots for each columns in the dataset
boxplot(weather)

# identify outliers
hist(df$a_col)
summary(df)

# View a histogram of absences, but force zeros to be bucketed to the right of zero
hist(students3$absences, right = FALSE)
```
